(window.webpackJsonp=window.webpackJsonp||[]).push([[185],{548:function(t,s,a){"use strict";a.r(s);var e=a(25),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"nuxt3-与-ssr-ssg-isr-实战"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nuxt3-与-ssr-ssg-isr-实战"}},[t._v("#")]),t._v(" Nuxt3 与 SSR/SSG/ISR 实战")]),t._v(" "),s("blockquote",[s("p",[t._v("30秒提纲：Nuxt3 基于 Nitro 实现通用渲染，数据获取统一在 "),s("code",[t._v("useAsyncData/useFetch")]),t._v("，结合 "),s("code",[t._v("routeRules")]),t._v(" 与 "),s("code",[t._v("isr")]),t._v("/"),s("code",[t._v("swr")]),t._v(" 做缓存与再生；部署到 Node 或 Edge（Vercel/Cloudflare）都开箱即用。")])]),t._v(" "),s("h2",{attrs:{id:"_1-渲染模式与选择"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-渲染模式与选择"}},[t._v("#")]),t._v(" 1. 渲染模式与选择")]),t._v(" "),s("ul",[s("li",[t._v("SSR：实时数据、良好 SEO；成本较高")]),t._v(" "),s("li",[t._v("SSG：构建时静态生成，极致性能，但数据需再验证")]),t._v(" "),s("li",[t._v("ISR：增量再生，适合大规模内容站点")])]),t._v(" "),s("h2",{attrs:{id:"_2-数据获取与缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-数据获取与缓存"}},[t._v("#")]),t._v(" 2. 数据获取与缓存")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// pages/index.vue")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pending"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useAsyncData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'home'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("$fetch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api/home'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  server"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 首次 SSR 获取")]),t._v("\n  lazy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 等待数据再渲染")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// server/api/home.get.ts")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineEventHandler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 读缓存或请求后端")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" msg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello nuxt3'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("useFetch")]),t._v(" 是 "),s("code",[t._v("useAsyncData + $fetch")]),t._v(" 语法糖")]),t._v(" "),s("li",[t._v("缓存：在 server route 使用 "),s("code",[t._v("cachedEventHandler")]),t._v("/"),s("code",[t._v("defineCachedFunction")]),t._v("，或利用 "),s("code",[t._v("routeRules")]),t._v(" 的 "),s("code",[t._v("isr/swr")])])]),t._v(" "),s("h2",{attrs:{id:"_3-路由规则与再生"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-路由规则与再生"}},[t._v("#")]),t._v(" 3. 路由规则与再生")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// nuxt.config.ts")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("defineNuxtConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  routeRules"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'/'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" swr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 60s 内命中缓存")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'/blog/**'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" isr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 静态再生")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'/admin/**'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" ssr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"_4-资源与性能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-资源与性能"}},[t._v("#")]),t._v(" 4. 资源与性能")]),t._v(" "),s("ul",[s("li",[t._v("图片："),s("code",[t._v("@nuxt/image")]),t._v(" 自适应/懒加载")]),t._v(" "),s("li",[t._v("关键脚本懒加载、组件按需；服务器端仅模块放到 "),s("code",[t._v("server/")]),t._v(" 目录")]),t._v(" "),s("li",[t._v("预取与预加载："),s("code",[t._v("useHead")]),t._v(" 注入 "),s("code",[t._v('<link rel="preload|prefetch">')])])]),t._v(" "),s("h2",{attrs:{id:"_5-环境变量与安全"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-环境变量与安全"}},[t._v("#")]),t._v(" 5. 环境变量与安全")]),t._v(" "),s("ul",[s("li",[t._v("私密变量放 "),s("code",[t._v(".env")]),t._v("，通过 "),s("code",[t._v("NITRO_*")]),t._v("/"),s("code",[t._v("runtimeConfig")]),t._v(" 注入；区分 "),s("code",[t._v("public")]),t._v(" 与 "),s("code",[t._v("private")])])]),t._v(" "),s("h2",{attrs:{id:"_6-部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-部署"}},[t._v("#")]),t._v(" 6. 部署")]),t._v(" "),s("ul",[s("li",[t._v("Node 服务器："),s("code",[t._v("pnpm build && node .output/server/index.mjs")])]),t._v(" "),s("li",[t._v("Vercel/Cloudflare："),s("code",[t._v("pnpm build")]),t._v(" 后直接部署 "),s("code",[t._v(".output")]),t._v("（Nitro 适配）")])]),t._v(" "),s("h2",{attrs:{id:"_7-ssr-与-pinia-状态注水"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-ssr-与-pinia-状态注水"}},[t._v("#")]),t._v(" 7. SSR 与 Pinia（状态注水）")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// server-entry 中创建 pinia 并注水")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" pinia "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createPinia")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pinia"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 服务端：pinia.state.value 赋初值")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 客户端：从 window.__PINIA__ 取回并 replace")]),t._v("\n")])])]),s("h2",{attrs:{id:"_8-常见坑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-常见坑"}},[t._v("#")]),t._v(" 8. 常见坑")]),t._v(" "),s("ul",[s("li",[t._v("仅服务端可用模块（fs、path）不要在客户端引用")]),t._v(" "),s("li",[s("code",[t._v("process.env")]),t._v(" 需改为 "),s("code",[t._v("runtimeConfig")])]),t._v(" "),s("li",[t._v("跨域：优先通过 server routes 代理")])]),t._v(" "),s("h2",{attrs:{id:"_9-checklist"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-checklist"}},[t._v("#")]),t._v(" 9. Checklist")]),t._v(" "),s("ul",[s("li",[t._v("[ ] 为页面设置 "),s("code",[t._v("routeRules")]),t._v(" 的 "),s("code",[t._v("swr/isr")])]),t._v(" "),s("li",[t._v("[ ] 服务端 API 使用 "),s("code",[t._v("cachedEventHandler")])]),t._v(" "),s("li",[t._v("[ ] 图片组件与懒加载")]),t._v(" "),s("li",[t._v("[ ] SSR 注水/脱水完整链路")])])])}),[],!1,null,null,null);s.default=n.exports}}]);