(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{448:function(a,t,s){"use strict";s.r(t);var e=s(25),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"本项目代理-proxy-配置说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本项目代理-proxy-配置说明"}},[a._v("#")]),a._v(" 本项目代理（Proxy）配置说明")]),a._v(" "),t("h2",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[a._v("#")]),a._v(" 背景")]),a._v(" "),t("p",[a._v("我的机器上为了访问个人 GitHub 项目，配置了全局代理（例如 "),t("code",[a._v("127.0.0.1:7890")]),a._v("）。\n但公司项目（本仓库）访问公司内网 GitLab/接口时不需要代理，甚至会因为走代理导致访问失败。")]),a._v(" "),t("p",[a._v("目标：")]),a._v(" "),t("ul",[t("li",[a._v("个人 GitHub 项目继续使用全局代理")]),a._v(" "),t("li",[t("strong",[a._v("公司项目（本仓库）不走代理")]),a._v("（仅对本项目生效）")])]),a._v(" "),t("h2",{attrs:{id:"影响范围说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#影响范围说明"}},[a._v("#")]),a._v(" 影响范围说明")]),a._v(" "),t("p",[a._v("这里的“代理”分两类：")]),a._v(" "),t("ol",[t("li",[t("p",[t("strong",[a._v("开发服务器反向代理（devServer proxy）")])]),a._v(" "),t("ul",[t("li",[a._v("例如 "),t("code",[a._v("src/manifest.json")]),a._v(" 里的 "),t("code",[a._v("h5.devServer.proxy")])]),a._v(" "),t("li",[a._v("作用：本地开发时把 "),t("code",[a._v("/api")]),a._v(" 等请求转发到后端")]),a._v(" "),t("li",[a._v("特点：仅影响本地 dev server 的请求转发，不影响 "),t("code",[a._v("git")]),a._v(" / "),t("code",[a._v("npm install")]),a._v(" 的网络访问")])])]),a._v(" "),t("li",[t("p",[t("strong",[a._v("系统/工具网络代理（影响 git、npm）")])]),a._v(" "),t("ul",[t("li",[a._v("例如 "),t("code",[a._v("git config --global http.proxy")]),a._v("、"),t("code",[a._v("npm config set proxy ...")])]),a._v(" "),t("li",[a._v("作用：影响 "),t("code",[a._v("git clone/pull")]),a._v("、"),t("code",[a._v("npm install")]),a._v(" 下载依赖的网络路径")]),a._v(" "),t("li",[a._v("本次要解决的就是这类代理："),t("strong",[a._v("全局保留，但对本仓库禁用")])])])])]),a._v(" "),t("h2",{attrs:{id:"本仓库已采用的解决方案-推荐"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本仓库已采用的解决方案-推荐"}},[a._v("#")]),a._v(" 本仓库已采用的解决方案（推荐）")]),a._v(" "),t("h3",{attrs:{id:"_1-对本仓库禁用-git-代理-覆盖全局"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-对本仓库禁用-git-代理-覆盖全局"}},[a._v("#")]),a._v(" 1) 对本仓库禁用 git 代理（覆盖全局）")]),a._v(" "),t("p",[a._v("在本仓库目录执行：")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" config "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--local")]),a._v(" http.proxy "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" config "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--local")]),a._v(" https.proxy "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),a._v("\n")])])]),t("p",[a._v("验证：")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" config "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--local")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--get")]),a._v(" http.proxy\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" config "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--local")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--get")]),a._v(" https.proxy\n")])])]),t("p",[a._v("说明：")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("--local")]),a._v(" 只会写入本仓库的 "),t("code",[a._v(".git/config")])]),a._v(" "),t("li",[a._v("不会影响其他仓库（例如你的 GitHub 仓库仍可继续走全局代理）")])]),a._v(" "),t("h3",{attrs:{id:"_2-对本项目禁用-npm-代理-项目级覆盖全局"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-对本项目禁用-npm-代理-项目级覆盖全局"}},[a._v("#")]),a._v(" 2) 对本项目禁用 npm 代理（项目级覆盖全局）")]),a._v(" "),t("p",[a._v("在项目根目录创建/维护 "),t("code",[a._v(".npmrc")]),a._v("（本仓库已创建）：")]),a._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Project-level npm config (overrides global ~/.npmrc)")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("proxy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("null")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("https-proxy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("null")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Add internal domains that should always bypass proxies")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("noproxy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("localhost,127.0.0.1,*.glzhealth.com,*.glzhealth.tech")]),a._v("\n")])])]),t("p",[a._v("验证（查看 project 级配置是否生效）：")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" config get proxy "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("project\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" config get https-proxy "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("project\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" config get noproxy "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("project\n")])])]),t("p",[a._v("预期：")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("proxy")]),a._v(" / "),t("code",[a._v("https-proxy")]),a._v(" 输出 "),t("code",[a._v("null")])]),a._v(" "),t("li",[t("code",[a._v("noproxy")]),a._v(" 输出内网域名列表")])]),a._v(" "),t("h2",{attrs:{id:"常用排查命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用排查命令"}},[a._v("#")]),a._v(" 常用排查命令")]),a._v(" "),t("h3",{attrs:{id:"查看全局-git-代理-不要在公司项目里改全局"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看全局-git-代理-不要在公司项目里改全局"}},[a._v("#")]),a._v(" 查看全局 git 代理（不要在公司项目里改全局）")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" config "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--global")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--get")]),a._v(" http.proxy\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" config "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--global")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--get")]),a._v(" https.proxy\n")])])]),t("h3",{attrs:{id:"查看当前-npm-的代理-可能来自-global-user-project-多个层级"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看当前-npm-的代理-可能来自-global-user-project-多个层级"}},[a._v("#")]),a._v(" 查看当前 npm 的代理（可能来自 global/user/project 多个层级）")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" config get proxy\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" config get https-proxy\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" config get noproxy\n")])])]),t("h2",{attrs:{id:"回滚-恢复方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#回滚-恢复方式"}},[a._v("#")]),a._v(" 回滚/恢复方式")]),a._v(" "),t("p",[a._v("如果未来不再需要对本仓库禁用代理：")]),a._v(" "),t("ol",[t("li",[a._v("删除本仓库的 git local 覆盖：")])]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" config "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--local")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--unset")]),a._v(" http.proxy\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" config "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--local")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--unset")]),a._v(" https.proxy\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("删除本仓库的项目级 npm 配置文件：")])]),a._v(" "),t("ul",[t("li",[a._v("删除根目录 "),t("code",[a._v(".npmrc")]),a._v(" 即可（或把相关项删掉）")])]),a._v(" "),t("h2",{attrs:{id:"备注"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#备注"}},[a._v("#")]),a._v(" 备注")]),a._v(" "),t("ul",[t("li",[a._v("本项目依赖中包含 "),t("code",[a._v("git+https://...")]),a._v(" 形式的 git 依赖，下载时会受 "),t("strong",[a._v("git 代理")]),a._v(" 影响，因此对本仓库禁用 git 代理是关键步骤之一。")])])])}),[],!1,null,null,null);t.default=r.exports}}]);