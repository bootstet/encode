(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{433:function(t,s,a){"use strict";a.r(s);var n=a(25),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"前端错误监控与-sourcemap-sentry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端错误监控与-sourcemap-sentry"}},[t._v("#")]),t._v(" 前端错误监控与 SourceMap（Sentry）")]),t._v(" "),s("blockquote",[s("p",[t._v("30秒提纲：以“版本”为核心串起上报→定位→回滚。构建时生成并上传 SourceMap，运行时初始化 SDK（环境/版本/用户），设置采样与分级，接入面包屑与自定义标签，错误到来后能够1分钟内定位到具体文件与行号，并量化影响面。")])]),t._v(" "),s("h2",{attrs:{id:"_1-初始化与关键配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-初始化与关键配置"}},[t._v("#")]),t._v(" 1. 初始化与关键配置")]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" Sentry "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@sentry/browser'")]),t._v("\nSentry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  dsn"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://<key>@sentry.io/<project>'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  environment"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  release"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("APP_NAME")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("@")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("APP_VERSION")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  integrations"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Sentry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("BrowserTracing")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  tracesSampleRate"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 性能追踪采样")]),t._v("\n  replaysSessionSampleRate"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("beforeSend")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 脱敏/过滤")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" event\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nSentry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" uid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ip_address"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{{auto}}'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nSentry"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTags")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("APP_NAME")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"_2-sourcemap-生成与上传-ci"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-sourcemap-生成与上传-ci"}},[t._v("#")]),t._v(" 2. SourceMap 生成与上传（CI）")]),t._v(" "),s("ul",[s("li",[t._v("构建：生成 "),s("code",[t._v("hidden-source-map")]),t._v(" 或独立 "),s("code",[t._v(".sourcemap")]),t._v(" 目录")]),t._v(" "),s("li",[t._v("上传：与 release 绑定，上传后页面禁止公开映射")])]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Build\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" npm run build\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Upload sourcemaps\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n    export VERSION=$(node -p \"require('./package.json').version\")\n    npx sentry-cli releases new $VERSION\n    npx sentry-cli releases files $VERSION upload-sourcemaps ./.sourcemap --rewrite --url-prefix '~/'\n    npx sentry-cli releases finalize $VERSION")]),t._v("\n")])])]),s("h2",{attrs:{id:"_3-错误分级与采样"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-错误分级与采样"}},[t._v("#")]),t._v(" 3. 错误分级与采样")]),t._v(" "),s("ul",[s("li",[t._v("采样："),s("code",[t._v("sampleRate")]),t._v("/"),s("code",[t._v("tracesSampleRate")]),t._v("；区分生产与灰度")]),t._v(" "),s("li",[t._v("分级：致命/高/中/低，结合影响范围（用户量/错误率）")]),t._v(" "),s("li",[t._v("面包屑：路由/接口/资源加载/自定义操作")])]),t._v(" "),s("h2",{attrs:{id:"_4-快速定位流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-快速定位流程"}},[t._v("#")]),t._v(" 4. 快速定位流程")]),t._v(" "),s("ol",[s("li",[t._v("查看 Issue → 版本/环境/平台维度")]),t._v(" "),s("li",[t._v("打开堆栈：确认是否已反混淆（需要 SourceMap）")]),t._v(" "),s("li",[t._v("关联最近变更 PR/部署")]),t._v(" "),s("li",[t._v("评估影响 → 决策回滚/修复")])]),t._v(" "),s("h2",{attrs:{id:"_5-最佳实践-checklist"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-最佳实践-checklist"}},[t._v("#")]),t._v(" 5. 最佳实践 Checklist")]),t._v(" "),s("ul",[s("li",[t._v("[ ] 生产环境禁用 inline SourceMap，仅上传到 Sentry")]),t._v(" "),s("li",[t._v("[ ] 为每次部署生成唯一 release，并写入页面（window."),s("strong",[t._v("APP_VERSION")]),t._v("）")]),t._v(" "),s("li",[t._v("[ ] 统一错误上报入口，添加用户/会话/路由标签")]),t._v(" "),s("li",[t._v("[ ] 采样与脱敏策略按环境区分")]),t._v(" "),s("li",[t._v("[ ] 搭建“错误趋势/Top 崩溃/版本对比”看板")])])])}),[],!1,null,null,null);s.default=e.exports}}]);